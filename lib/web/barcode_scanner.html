<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <title>Barcode Scanner</title>
    <script src="https://unpkg.com/html5-qrcode" type="text/javascript"></script>
    <style>
      body {
        margin: 0;
        padding: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
        position: relative;
        height: 100%;
      }
      #reader {
        width: 100%;
        height: 100%;
        min-height: 320px;
      }
      #status {
        position: absolute;
        bottom: 10px;
        left: 0;
        right: 0;
        text-align: center;
        font-size: 20px;
        font-weight: bold;
        color: green;
        background: rgba(255, 255, 255, 0.8);
        display: none;
        z-index: 10;
      }
    </style>
  </head>
  <body>
    <div id="reader"></div>
    <div id="status">BARCODE SCANNED</div>

    <script>
      function resetReaderDom() {
        const existing = document.getElementById("reader");
        if (existing) existing.remove();

        const reader = document.createElement("div");
        reader.id = "reader";
        reader.style.width = "100%";
        reader.style.height = "100%";
        document.body.insertBefore(reader, document.getElementById("status"));
      }

      function startScanner() {
        resetReaderDom();

        const html5QrCode = new Html5Qrcode("reader");
        const status = document.getElementById("status");

        html5QrCode
          .start(
            { facingMode: "environment" },
            {
              fps: 10,
              qrbox: { width: 300, height: 120 },
              aspectRatio: 1.5,
            },
            (decodedText) => {
              console.log("✅ Scanned:", decodedText);
              status.style.display = "block";
              html5QrCode.stop();
              setTimeout(() => {
                window.parent.postMessage(decodedText, "*");
              }, 500);
            },
            (error) => {
              // Ignore frame scan failures
            }
          )
          .catch((err) => {
            console.error("❌ Scanner start error:", err);
          });
      }

      // Run scanner after iframe is loaded
      setTimeout(startScanner, 300);
    </script>
  </body>
</html>

